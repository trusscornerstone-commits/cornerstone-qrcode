<!DOCTYPE html>
<html lang="pt-BR">
<head>
  {% load static %}
  <meta charset="UTF-8">
  <title>Scanner de QR Code</title>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <style>
    :root { color-scheme: dark; }
    body,html {
      margin:0; padding:0; height:100%;
      background:#000; font-family: system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto;
      overflow:hidden;
    }
    .scanner-wrapper { position:relative; width:100%; height:100dvh; display:flex; flex-direction:column; }
    #videoContainer { position:relative; flex:1; display:flex; align-items:center; justify-content:center; background:#000; overflow:hidden; }
    #videoContainer video { width:100%; height:100%; object-fit:cover; background:#000; }
    .top-bar {
      position:fixed; top:0; left:0; width:100%; display:flex; align-items:center;
      justify-content:space-between; padding:12px 16px;
      background:linear-gradient(to bottom, rgba(0,0,0,0.7), rgba(0,0,0,0));
      z-index:10;
    }
    .top-bar button {
      background:rgba(255,255,255,0.12); color:#fff; border:1px solid rgba(255,255,255,0.28);
      border-radius:8px; padding:8px 14px; font-size:14px; cursor:pointer;
      backdrop-filter: blur(4px);
    }
    .feedback-box {
      position:fixed; bottom:0; left:0; width:100%;
      padding:10px 14px 18px;
      background:linear-gradient(to top, rgba(0,0,0,0.7), rgba(0,0,0,0));
      color:#ddd; font-size:14px; z-index:10; text-align:center; min-height:48px;
    }
    .error { color:#ff6b6b; }
    .scan-frame {
      position:absolute; width:60vmin; height:60vmin; max-width:80%; max-height:60%;
      border:2px solid rgba(255,255,255,0.35); border-radius:12px;
      box-shadow:0 0 0 200vmax rgba(0,0,0,0.35); backdrop-filter: blur(2px);
      pointer-events:none;
    }
    #startBtn {
      position:absolute; inset:0; display:flex; flex-direction:column;
      align-items:center; justify-content:center; gap:14px;
      background:#000; color:#fff; font-size:16px; z-index:20;
    }
    #startBtn.hidden { display:none; }
    #startBtn button {
      background:#1d70f2; color:#fff; border:none;
      padding:14px 26px; font-size:16px; border-radius:10px; cursor:pointer;
    }
  </style>
</head>
<body>
  <div class="scanner-wrapper">
    <div id="videoContainer">
      <div id="startBtn" class="hidden">
        <div>Toque para iniciar o scanner</div>
        <button type="button" id="manualStart">Iniciar</button>
      </div>
      <div class="scan-frame" id="scanFrame"></div>
      <video id="scanVideo" playsinline autoplay muted></video>
    </div>
    <div class="top-bar">
      <button type="button" id="backBtn">Voltar</button>
      <button type="button" id="cancelBtn">Cancelar</button>
    </div>
    <div class="feedback-box" id="feedbackBox">Carregando...</div>
  </div>

  <script>
    // Reutiliza APP_CONFIG definido em base ou define local se não existir
    window.APP_CONFIG = window.APP_CONFIG || { urls: {} };
    window.APP_CONFIG.urls.trussDetail = window.APP_CONFIG.urls.trussDetail || "{% url 'truss_detail' pk=0 %}".replace(/0\/?$/, "");
    window.APP_CONFIG.urls.home = window.APP_CONFIG.urls.home || "{% url 'home' %}";
    // Disponibiliza variáveis locais
    const trussDetailUrl = window.APP_CONFIG.urls.trussDetail;
    const homeUrl = window.APP_CONFIG.urls.home;
  </script>
  <script src="{% static 'accounts/scan_truss_page.js' %}"></script>
</body>
</html>